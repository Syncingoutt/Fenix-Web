<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Fenix Overlay</title>
    <style>

:root {
  --bg: #161616;
  --bg-shade: #272727;
  --text: #fafafa;
  --primary: #de5c0b;
  --secondary: #000000;
  --accent: #ffffff;
  --border: #7e7e7e;
  --border-shade: #3d3d3d;
  
  --scale: 1;
  --text-scale: 1;
  
}

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html, body {
        background: transparent;
        overflow: hidden;
        user-select: none;
      }

      .widget {
        background: rgba(22, 22, 22, 0.85);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 10px 14px;
        font-family: 'Segoe UI', 'Manrope', sans-serif;
        color: #fafafa;
        display: flex;
        flex-direction: column;
        gap: 4px;
        cursor: move;
        -webkit-app-region: drag;
        min-width: 130px;
      }

      .stat-row {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
      }

      .stat-label {
        color: #808080;
        font-weight: 500;
        min-width: 45px;
      }

      .stat-value {
        color: #fafafa;
        font-weight: 600;
        font-variant-numeric: tabular-nums;
      }

      .stat-value.duration {
        color: #de5c0b;
        font-size: 14px;
      }

      .stat-value.hourly {
        color: #10b981;
      }

      .stat-value.total {
        color: #fafafa;
      }

      .close-btn {
        position: absolute;
        top: 4px;
        right: 6px;
        width: 14px;
        height: 14px;
        background: transparent;
        border: none;
        color: #808080;
        font-size: 12px;
        cursor: pointer;
        -webkit-app-region: no-drag;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 3px;
        transition: opacity 0.2s, background 0.2s;
      }

      .close-btn:hover {
        background: rgba(239, 68, 68, 0.3);
        color: #ef4444;
      }

      .timer-controls {
        display: none;
        margin-top: 6px;
      }

      .timer-controls.visible {
        display: block;
      }

      .timer-control-btn {
        width: 100%;
        height: 26px;
        background: transparent;
        border: 1px solid rgba(222, 92, 11, 0.5);
        color: #de5c0b;
        cursor: pointer;
        -webkit-app-region: no-drag;
        display: none;
        align-items: center;
        justify-content: center;
        gap: 6px;
        border-radius: 4px;
        transition: all 0.2s;
        font-family: inherit;
        font-size: 11px;
        font-weight: 500;
      }

      .timer-control-btn.visible {
        display: flex;
      }

      .timer-control-btn:hover {
        background: rgba(222, 92, 11, 0.15);
        border-color: rgba(222, 92, 11, 0.8);
        color: #ff7a2e;
      }

      .timer-control-btn svg {
        width: 12px;
        height: 12px;
      }

    </style>
  </head>
  <body>
    <div class="widget">
      <button class="close-btn" id="closeBtn">X</button>
      <div class="stat-row">
        <span class="stat-label">Time</span>
        <span class="stat-value duration" id="duration">00:00:00</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">FE/hr</span>
        <span class="stat-value hourly" id="hourly">0.00</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Total</span>
        <span class="stat-value total" id="total">0.00</span>
      </div>
      <div class="timer-controls" id="timerControls">
        <button class="timer-control-btn" id="pauseHourly" title="Pause">
          <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="4" width="4" height="16" rx="1"/>
            <rect x="14" y="4" width="4" height="16" rx="1"/>
          </svg>
          <span>Pause</span>
        </button>
        <button class="timer-control-btn" id="resumeHourly" title="Resume">
          <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 5.14v13.72c0 .87.93 1.4 1.65.93l10.59-6.86c.64-.42.64-1.44 0-1.86L9.65 4.21C8.93 3.74 8 4.27 8 5.14z"/>
          </svg>
          <span>Resume</span>
        </button>
      </div>
    </div>

    <script>
      const { ipcRenderer } = require('electron');

      const durationEl = document.getElementById('duration');
      const hourlyEl = document.getElementById('hourly');
      const totalEl = document.getElementById('total');
      const closeBtn = document.getElementById('closeBtn');
      const timerControls = document.getElementById('timerControls');
      const pauseBtn = document.getElementById('pauseHourly');
      const resumeBtn = document.getElementById('resumeHourly');

      function formatTime(seconds) {
        const hrs = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }

      function formatValue(value) {
        return value.toFixed(2);
      }

      function updateTimerButtons(isHourlyMode, isPaused) {
        if (isHourlyMode) {
          timerControls.classList.add('visible');
          pauseBtn.classList.toggle('visible', !isPaused);
          resumeBtn.classList.toggle('visible', isPaused);
        } else {
          timerControls.classList.remove('visible');
          pauseBtn.classList.remove('visible');
          resumeBtn.classList.remove('visible');
        }
      }

      // Listen for updates from main process
      ipcRenderer.on('widget-update', (event, data) => {
        if (data.duration !== undefined) {
          durationEl.textContent = formatTime(data.duration);
        }
        if (data.hourly !== undefined) {
          hourlyEl.textContent = formatValue(data.hourly);
        }
        if (data.total !== undefined) {
          totalEl.textContent = formatValue(data.total);
        }
        // Update button visibility
        updateTimerButtons(data.isHourlyMode, data.isPaused);
      });

      closeBtn.addEventListener('click', () => {
        ipcRenderer.send('close-overlay-widget');
      });

      pauseBtn.addEventListener('click', () => {
        ipcRenderer.send('widget-pause-hourly');
      });

      resumeBtn.addEventListener('click', () => {
        ipcRenderer.send('widget-resume-hourly');
      });
    </script>
  </body>
</html>
